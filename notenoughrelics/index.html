<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NotEnoughRelics - Relic Generator</title>
  <link rel="icon" type="image/png" href="../img/favicon.png" />
  <style>
    @font-face{font-family:'CustomFont';src:url('../fonts/font.otf') format('opentype');font-weight:normal;font-style:normal}
    @font-face{font-family:'CustomFont';src:url('../fonts/bold.otf') format('opentype');font-weight:700;font-style:normal}
    :root{--bg:#0d0d0d;--card:#141414;--muted:#bfc9df;--accent:#5561ff;--glow:rgba(115,135,255,0.12);--pastel-blue:#a8d5ff;--gold:#ffd700}
    *{box-sizing:border-box;font-family:'CustomFont',Inter,"Segoe UI",Roboto,Arial,sans-serif}
    body{margin:0;background:var(--bg);background-image:linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);background-size:50px 50px;background-position:center center;color:#e9eef8;-webkit-font-smoothing:antialiased;display:flex;gap:24px;padding:36px;max-width:1400px;margin:0 auto}
    .container{flex:1;max-width:820px;padding:22px;background:var(--card);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55)}
    .back-link{display:inline-flex;align-items:center;gap:8px;color:var(--pastel-blue);text-decoration:none;margin-bottom:20px;font-weight:500;transition:color .2s}
    .back-link:hover{color:#c0e3ff}
    h1,h2{text-align:center;margin:6px 0;font-weight:600}
    h2{color:var(--muted);font-weight:500;font-size:16px}
    h3{color:#e9eef8;margin:20px 0 12px;font-size:18px}
    .form-section{background:#0f0f10;padding:20px;border:1px solid #222;border-radius:10px;margin-bottom:20px}
    .form-row{display:flex;gap:12px;margin-bottom:12px;align-items:center}
    .form-row.full{flex-direction:column;align-items:stretch}
    .form-row label{min-width:120px;color:#dfe7ff;font-weight:600;font-size:14px}
    .form-row input,.form-row select,.form-row textarea{flex:1;padding:10px;background:#141414;color:#e9eef8;border:1px solid #222;border-radius:8px;font-size:14px;font-family:inherit}
    .form-row input:focus,.form-row select:focus,.form-row textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(85,97,255,0.1)}
    .form-row textarea{min-height:80px;resize:vertical;font-family:ui-monospace,monospace;font-size:13px}
    .upload-box{display:flex;justify-content:center;margin:18px 0}
    .upload-label{padding:10px 16px;border-radius:9px;background:linear-gradient(180deg,#3a3aff,#3340e6);color:#fff;font-weight:700;cursor:pointer;user-select:none;transition:transform .12s}
    .upload-label:hover{transform:translateY(-2px)}
    input[type="file"]{display:none}
    #preview{text-align:center;margin:12px 0}
    #preview img{display:inline-block;width:128px;height:128px;image-rendering:pixelated;border-radius:8px;border:2px solid var(--gold);box-shadow:0 0 20px rgba(255,215,0,0.3)}
    .error{text-align:center;color:#ff6b6b;min-height:18px;margin:6px 0}
    .info-text{color:var(--muted);margin-bottom:12px;font-size:14px;line-height:1.5}
    .abilities-section{background:#0f0f10;padding:15px;border:1px solid #222;border-radius:10px;margin-bottom:20px}
    .ability-item{background:#141414;padding:12px;border:1px solid #2a2a2a;border-radius:8px;margin-bottom:10px;position:relative}
    .ability-item .remove-btn{position:absolute;top:8px;right:8px;background:#ff4444;color:#fff;border:0;border-radius:6px;padding:4px 10px;cursor:pointer;font-size:12px;font-weight:700;transition:background .2s}
    .ability-item .remove-btn:hover{background:#ff6666}
    .add-ability-btn{width:100%;padding:10px;background:var(--accent);color:#fff;border:0;border-radius:8px;font-weight:700;cursor:pointer;transition:all .2s;font-size:14px}
    .add-ability-btn:hover{transform:translateY(-2px);background:#6d79ff}
    .generate-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--gold),#ffaa00);color:#000;border:0;border-radius:10px;font-weight:700;cursor:pointer;transition:all .2s;font-size:16px;margin-top:20px;box-shadow:0 4px 15px rgba(255,215,0,0.3)}
    .generate-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,215,0,0.5)}
    .generate-btn:disabled{background:#555;color:#888;cursor:not-allowed;transform:none;box-shadow:none}
    .rarity-select{display:flex;gap:8px;flex-wrap:wrap}
    .rarity-option{flex:1;min-width:80px;padding:8px;text-align:center;border:2px solid #222;border-radius:8px;cursor:pointer;transition:all .2s;font-weight:600;font-size:13px}
    .rarity-option:hover{border-color:var(--accent)}
    .rarity-option.selected{border-color:currentColor;box-shadow:0 0 15px currentColor}
    .rarity-option.common{color:#ffffff}
    .rarity-option.uncommon{color:#55ff55}
    .rarity-option.rare{color:#5555ff}
    .rarity-option.epic{color:#aa00aa}
    .rarity-option.legendary{color:var(--gold)}
    .rarity-option.mythic{color:#ff5555}
    .sidebar{width:340px;display:flex;flex-direction:column;gap:20px;align-self:flex-start;position:sticky;top:36px}
    .info-box{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55)}
    .info-title{margin:0 0 12px 0;font-size:20px;font-weight:700;color:#e9eef8}
    .info-content{font-size:14px;line-height:1.6;color:var(--muted)}
    .plugin-link{color:var(--accent);text-decoration:none;font-weight:600;transition:color .2s ease}
    .plugin-link:hover{color:#ffea73;text-decoration:underline}
    .feature-list{margin:12px 0;padding-left:20px}
    .feature-list li{margin-bottom:8px;color:var(--muted)}
    .creator-box{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55);display:flex;align-items:center;gap:16px}
    .creator-avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;flex-shrink:0;box-shadow:0 0 20px rgba(211,146,6,0.4),0 0 40px rgba(211,190,6,0.3),0 0 60px rgba(211,211,6,0.1);animation:glowPulse 3s ease-in-out infinite}
    @keyframes glowPulse{0%,100%{box-shadow:0 0 20px rgba(211,146,6,0.5),0 0 40px rgba(211,190,6,0.3),0 0 60px rgba(211,211,6,0.1)}50%{box-shadow:0 0 30px rgba(211,146,6,0.6),0 0 60px rgba(211,190,6,0.4),0 0 90px rgba(211,211,6,0.1)}}
    .creator-info{flex:1}
    .creator-title{margin:0;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;font-weight:600}
    .creator-name{margin:4px 0 8px 0;font-size:15px;font-weight:400;color:#e9eef8}
    .github-link{display:inline-flex;align-items:center;gap:6px;color:var(--pastel-blue);text-decoration:none;font-size:14px;font-weight:400;transition:color .2s ease}
    .github-link:hover{color:#c0e3ff}
    .github-link svg{width:18px;height:18px}
    @media(max-width:1200px){body{flex-direction:column;padding:18px}.sidebar{width:100%;position:static}}
    @media(max-width:540px){.container{padding:14px}.form-row{flex-direction:column;align-items:stretch}.form-row label{min-width:auto}.rarity-select{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">← Back to Home</a>
    <h1>NotEnoughRelics</h1>
    <h2>Legendary Relic Generator</h2>
    
    <div class="form-section">
      <h3>Basic Information</h3>
      <div class="form-row">
        <label>Relic ID:</label>
        <input type="text" id="relicID" placeholder="ex: ancient_sword" required>
      </div>
      <div class="form-row">
        <label>Relic Name:</label>
        <input type="text" id="relicName" placeholder="ex: Ancient Sword of Power" required>
      </div>
      <div class="form-row">
        <label>Material:</label>
        <select id="relicMaterial">
          <option value="DIAMOND_SWORD">DIAMOND_SWORD</option>
          <option value="GOLDEN_SWORD">GOLDEN_SWORD</option>
          <option value="NETHERITE_SWORD">NETHERITE_SWORD</option>
          <option value="DIAMOND_PICKAXE">DIAMOND_PICKAXE</option>
          <option value="DIAMOND_AXE">DIAMOND_AXE</option>
          <option value="BOW">BOW</option>
          <option value="TRIDENT">TRIDENT</option>
          <option value="SHIELD">SHIELD</option>
          <option value="TOTEM_OF_UNDYING">TOTEM_OF_UNDYING</option>
          <option value="ENCHANTED_BOOK">ENCHANTED_BOOK</option>
          <option value="NETHER_STAR">NETHER_STAR</option>
          <option value="ELYTRA">ELYTRA</option>
        </select>
      </div>
      <div class="form-row full">
        <label>Rarity:</label>
        <div class="rarity-select">
          <div class="rarity-option common" data-rarity="COMMON">Common</div>
          <div class="rarity-option uncommon" data-rarity="UNCOMMON">Uncommon</div>
          <div class="rarity-option rare" data-rarity="RARE">Rare</div>
          <div class="rarity-option epic" data-rarity="EPIC">Epic</div>
          <div class="rarity-option legendary selected" data-rarity="LEGENDARY">Legendary</div>
          <div class="rarity-option mythic" data-rarity="MYTHIC">Mythic</div>
        </div>
      </div>
      <div class="form-row full">
        <label>Lore (one line per row):</label>
        <textarea id="relicLore" placeholder="&7An ancient weapon forged in...
&7the fires of the Nether itself.
&8
&eRight-click to unleash power!"></textarea>
      </div>
    </div>

    <div class="form-section">
      <h3>Texture (16x16)</h3>
      <div class="upload-box">
        <label for="textureInput" class="upload-label">Import Relic Texture</label>
        <input id="textureInput" type="file" accept="image/png, image/jpeg" />
      </div>
      <p id="errorMsg" class="error"></p>
      <div id="preview"></div>
    </div>

    <div class="abilities-section">
      <h3>Special Abilities</h3>
      <p class="info-text">Add special abilities that trigger on specific events (right-click, left-click, etc.)</p>
      <div id="abilitiesContainer"></div>
      <button class="add-ability-btn" id="addAbilityBtn">+ Add Ability</button>
    </div>

    <div class="form-section">
      <h3>Stats & Attributes</h3>
      <div class="form-row">
        <label>Damage Boost:</label>
        <input type="number" id="damageBoost" placeholder="0" min="0" step="0.5">
      </div>
      <div class="form-row">
        <label>Attack Speed:</label>
        <input type="number" id="attackSpeed" placeholder="0" min="0" max="10" step="0.1">
      </div>
      <div class="form-row">
        <label>Max Health:</label>
        <input type="number" id="maxHealth" placeholder="0" min="0" step="1">
      </div>
      <div class="form-row">
        <label>Movement Speed:</label>
        <input type="number" id="movementSpeed" placeholder="0" min="0" max="1" step="0.01">
      </div>
      <div class="form-row">
        <label>Durability:</label>
        <input type="number" id="durability" placeholder="-1 (unbreakable)" step="1">
      </div>
    </div>

    <button class="generate-btn" id="generateBtn">Generate & Download YAML</button>
  </div>

  <aside class="sidebar">
    <div class="info-box">
      <h3 class="info-title">About NotEnoughRelics</h3>
      <p class="info-content">
        Create powerful custom relics for your server with unique abilities, stats, and textures. This generator helps you build YAML configuration files for the
        <a href="https://polymart.org" target="_blank" class="plugin-link">NotEnoughRelics</a>
        plugin.
      </p>
      <ul class="feature-list">
        <li>Custom 16×16 textures</li>
        <li>Multiple rarity tiers</li>
        <li>Special abilities & triggers</li>
        <li>Stat modifications</li>
        <li>Rich lore & formatting</li>
      </ul>
    </div>

    <div class="creator-box">
      <img src="../img/profile.jpg" alt="k0dev profile" class="creator-avatar" onerror="this.style.display='none'">
      <div class="creator-info">
        <p class="creator-title">Coded by</p>
        <p class="creator-name">@k0dev._.0</p>
        <a href="https://github.com/k0dev" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
      </div>
    </div>
  </aside>

  <script>
    let selectedRarity = 'LEGENDARY';
    let pixelData = null;
    let abilities = [];

    // Rarity selection
    document.querySelectorAll('.rarity-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.rarity-option').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        selectedRarity = option.dataset.rarity;
      });
    });

    // Add ability
    document.getElementById('addAbilityBtn').addEventListener('click', () => {
      const abilityId = Date.now();
      abilities.push(abilityId);
      
      const container = document.getElementById('abilitiesContainer');
      const abilityDiv = document.createElement('div');
      abilityDiv.className = 'ability-item';
      abilityDiv.dataset.id = abilityId;
      
      abilityDiv.innerHTML = `
        <button class="remove-btn" onclick="removeAbility(${abilityId})">Remove</button>
        <div class="form-row">
          <label style="min-width:100px">Trigger:</label>
          <select class="ability-trigger">
            <option value="RIGHT_CLICK">Right Click</option>
            <option value="LEFT_CLICK">Left Click</option>
            <option value="SHIFT_RIGHT_CLICK">Shift + Right Click</option>
            <option value="ON_HIT">On Hit Enemy</option>
            <option value="ON_KILL">On Kill</option>
            <option value="PASSIVE">Passive</option>
          </select>
        </div>
        <div class="form-row">
          <label style="min-width:100px">Effect:</label>
          <select class="ability-effect">
            <option value="LIGHTNING">Strike Lightning</option>
            <option value="EXPLOSION">Create Explosion</option>
            <option value="HEAL">Heal Player</option>
            <option value="DAMAGE">Area Damage</option>
            <option value="SPEED">Speed Boost</option>
            <option value="STRENGTH">Strength Boost</option>
            <option value="TELEPORT">Teleport Forward</option>
            <option value="FIRE">Set on Fire</option>
          </select>
        </div>
        <div class="form-row">
          <label style="min-width:100px">Cooldown (s):</label>
          <input type="number" class="ability-cooldown" placeholder="10" min="0" step="1">
        </div>
        <div class="form-row">
          <label style="min-width:100px">Power:</label>
          <input type="number" class="ability-power" placeholder="5.0" min="0" step="0.5">
        </div>
      `;
      
      container.appendChild(abilityDiv);
    });

    window.removeAbility = (id) => {
      abilities = abilities.filter(a => a !== id);
      document.querySelector(`[data-id="${id}"]`).remove();
    };

    // Image upload
    document.getElementById('textureInput').addEventListener('change', function(e) {
      const file = this.files[0];
      const errorEl = document.getElementById('errorMsg');
      const preview = document.getElementById('preview');
      
      errorEl.textContent = '';
      preview.innerHTML = '';
      pixelData = null;

      if (!file) return;

      const img = new Image();
      const url = URL.createObjectURL(file);
      img.src = url;

      img.onload = () => {
        if (img.width !== 16 || img.height !== 16) {
          errorEl.textContent = `Error: Only 16x16 textures supported. ${img.width}x${img.height} detected.`;
          URL.revokeObjectURL(url);
          return;
        }

        preview.innerHTML = `<img src="${url}" alt="Relic texture preview">`;

        const canvas = document.createElement('canvas');
        canvas.width = 16;
        canvas.height = 16;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, 16, 16).data;
        pixelData = [];

        for (let i = 0; i < 256; i++) {
          const idx = i * 4;
          const r = data[idx];
          const g = data[idx + 1];
          const b = data[idx + 2];
          const a = data[idx + 3];

          if (a === 0) {
            pixelData.push(0);
          } else {
            pixelData.push((r * 65536) + (g * 256) + b);
          }
        }

        URL.revokeObjectURL(url);
      };

      img.onerror = () => {
        errorEl.textContent = "Error: could not load the image.";
        URL.revokeObjectURL(url);
      };
    });

    // Generate YAML
    document.getElementById('generateBtn').addEventListener('click', () => {
      const id = document.getElementById('relicID').value.trim();
      const name = document.getElementById('relicName').value.trim();
      const material = document.getElementById('relicMaterial').value;
      const lore = document.getElementById('relicLore').value.trim();

      if (!id || !name) {
        alert('Please fill in at least Relic ID and Name.');
        return;
      }

      let yaml = `id: ${id}\n`;
      yaml += `name: "${name}"\n`;
      yaml += `material: ${material}\n`;
      yaml += `rarity: ${selectedRarity}\n`;

      if (lore) {
        yaml += `lore:\n`;
        lore.split('\n').forEach(line => {
          if (line.trim()) yaml += `  - "${line}"\n`;
        });
      }

      // Stats
      const stats = {};
      const damage = document.getElementById('damageBoost').value;
      const attackSpeed = document.getElementById('attackSpeed').value;
      const maxHealth = document.getElementById('maxHealth').value;
      const movSpeed = document.getElementById('movementSpeed').value;
      const durability = document.getElementById('durability').value;

      if (damage) stats.damage = parseFloat(damage);
      if (attackSpeed) stats.attack_speed = parseFloat(attackSpeed);
      if (maxHealth) stats.max_health = parseFloat(maxHealth);
      if (movSpeed) stats.movement_speed = parseFloat(movSpeed);
      if (durability) stats.durability = parseInt(durability);

      if (Object.keys(stats).length > 0) {
        yaml += `stats:\n`;
        for (let [key, val] of Object.entries(stats)) {
          yaml += `  ${key}: ${val}\n`;
        }
      }

      // Abilities
      if (abilities.length > 0) {
        yaml += `abilities:\n`;
        abilities.forEach((abilityId, idx) => {
          const abilityDiv = document.querySelector(`[data-id="${abilityId}"]`);
          const trigger = abilityDiv.querySelector('.ability-trigger').value;
          const effect = abilityDiv.querySelector('.ability-effect').value;
          const cooldown = abilityDiv.querySelector('.ability-cooldown').value || '0';
          const power = abilityDiv.querySelector('.ability-power').value || '1.0';

          yaml += `  ability_${idx + 1}:\n`;
          yaml += `    trigger: ${trigger}\n`;
          yaml += `    effect: ${effect}\n`;
          yaml += `    cooldown: ${cooldown}\n`;
          yaml += `    power: ${power}\n`;
        });
      }

      // Pixels
      if (pixelData) {
        yaml += `pixels:\n`;
        pixelData.forEach((val, i) => {
          if (val !== 0) {
            yaml += `  '${i}': ${val}\n`;
          }
        });
      }

      const blob = new Blob([yaml], { type: 'text/yaml' });
      const url = URL.createObjectURL(blob);
      const dl = document.createElement('a');
      dl.href = url;
      dl.download = `${id}.yml`;
      dl.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>