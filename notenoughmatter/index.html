<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NotEnoughMatter - Texture HEX Viewer</title>
  <link rel="icon" type="image/png" href="../img/favicon.png" />
  <style>
    @font-face{font-family:'CustomFont';src:url('../fonts/font.otf') format('opentype');font-weight:normal;font-style:normal}
    @font-face{font-family:'CustomFont';src:url('../fonts/bold.otf') format('opentype');font-weight:700;font-style:normal}
    :root{--bg:#0d0d0d;--card:#141414;--muted:#bfc9df;--accent:#5561ff;--glow:rgba(115,135,255,0.12);--pastel-blue:#a8d5ff}
    *{box-sizing:border-box;font-family:'CustomFont',Inter,"Segoe UI",Roboto,Arial,sans-serif}
    body{margin:0;background:var(--bg);background-image:linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);background-size:50px 50px;background-position:center center;color:#e9eef8;-webkit-font-smoothing:antialiased;display:flex;gap:24px;padding:36px;max-width:1400px;margin:0 auto}
    .container{flex:1;max-width:820px;padding:22px;background:var(--card);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55)}
    .back-link{display:inline-flex;align-items:center;gap:8px;color:var(--pastel-blue);text-decoration:none;margin-bottom:20px;font-weight:500;transition:color .2s}
    .back-link:hover{color:#c0e3ff}
    h1,h2{text-align:center;margin:6px 0;font-weight:600}
    h2{color:var(--muted);font-weight:500;font-size:16px}
    .upload-box{display:flex;justify-content:center;margin:18px 0}
    .upload-label{padding:10px 16px;border-radius:9px;background:linear-gradient(180deg,#3a3aff,#3340e6);color:#fff;font-weight:700;cursor:pointer;user-select:none}
    .upload-label:hover{transform:translateY(-2px);transition:.12s}
    input[type="file"]{display:none}
    .error{text-align:center;color:#ff6b6b;min-height:18px;margin:6px 0}
    .info-text{text-align:center;color:var(--muted);margin-bottom:12px}
    #preview img{display:block;margin:0 auto 12px;width:128px;height:128px;image-rendering:pixelated;border-radius:8px;border:1px solid #222}
    .hex-line-box{position:relative;display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;margin:10px 0;background:linear-gradient(180deg,#0f0f10,#0c0c0c);border:1px solid #222;overflow:visible;transition:box-shadow .24s ease,border-color .24s ease,background-color .24s ease,transform .22s ease}
    .hex-line-box.copied{box-shadow:0 6px 18px rgba(0,0,0,0.6)}
    .hex-line-box.next-glow{border-color:rgba(255,255,255,0.95);box-shadow:0 12px 36px rgba(85,97,255,0.14)}
    .hex-line-box.next-glow::before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.04));pointer-events:none;z-index:1;transition:opacity .28s ease}
    .left-arrow.big-arrow{position:absolute;left:-32px;top:50%;transform:translateY(-50%);font-size:28px;color:white;opacity:.95;pointer-events:none;animation:arrowPulse 1.2s infinite ease-in-out}
    @keyframes arrowPulse{0%{transform:translate(-4px,-50%) scale(1);opacity:.75}50%{transform:translate(4px,-50%) scale(1.04);opacity:1}100%{transform:translate(-4px,-50%) scale(1);opacity:.75}}
    .hex-line-box.slide-down{animation:slideDownIn 260ms cubic-bezier(.2,.9,.3,1) forwards}
    @keyframes slideDownIn{from{transform:translateY(-10px);opacity:.0}to{transform:translateY(0);opacity:1}}
    .line-number{min-width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#0f0f10;border:1px solid #222;color:#dfe7ff;font-weight:700;font-size:13px;z-index:2}
    .hex-text{flex:1;font-family:ui-monospace,monospace;font-size:13px;color:#e9eef8;white-space:pre-wrap;overflow-wrap:break-word;z-index:2;padding-left:6px}
    .copy-btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;z-index:2;transition:transform .12s ease,background .12s ease}
    .copy-btn:hover{transform:translateY(-2px);background:#6d79ff}
    .copied-label{margin-left:10px;color:#7fffa1;font-weight:700;opacity:0;z-index:2;transition:opacity .14s ease}
    .copied-label.visible{opacity:1}
    .divider{margin:28px 0;border:0;border-top:1px solid #2a2a2a}
    .video-wrapper{position:relative;width:100%;padding-bottom:56.25%;border-radius:10px;overflow:hidden;border:1px solid #222;background:#000}
    .video-wrapper iframe{position:absolute;width:100%;height:100%;border:0}
    .yaml-block{background:#0f0f10;padding:15px;border:1px solid #222;border-radius:10px;margin-bottom:20px}
    .yaml-row{display:flex;align-items:center;justify-content:space-between;margin:8px 0}
    .yaml-row label{width:90px;color:#dfe7ff;font-weight:600}
    .yaml-row input,.yaml-row select{flex:1;padding:8px;background:#141414;color:#e9eef8;border:1px solid #222;border-radius:8px}
    .btn-disabled{background:#555!important;cursor:not-allowed!important;opacity:.6}
    .btn-disabled:hover{transform:none!important;background:#555!important}
    .sidebar{width:340px;display:flex;flex-direction:column;gap:20px;align-self:flex-start;position:sticky;top:36px}
    .disclaimer-box{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55)}
    .disclaimer-title{margin:0 0 12px 0;font-size:20px;font-weight:700;color:#e9eef8}
    .disclaimer-text{font-size:14px;line-height:1.6;color:var(--muted);margin-bottom:18px}
    .plugin-link{color:var(--accent);text-decoration:none;font-weight:600;transition:color .2s ease}
    .plugin-link:hover{color:#ffea73;text-decoration:underline}
    .steps-section{margin-top:20px}
    .steps-title{font-size:16px;font-weight:600;color:#e9eef8;margin:0 0 12px 0}
    .steps-list{margin:0;padding-left:20px;font-size:13px;line-height:1.7;color:var(--muted)}
    .steps-list li{margin-bottom:10px}
    .steps-list code{background:#0f0f10;padding:2px 6px;border-radius:4px;font-family:ui-monospace,monospace;color:#7fffa1;font-size:12px}
    .creator-box{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.55);display:flex;align-items:center;gap:16px}
    .creator-avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;flex-shrink:0;box-shadow:0 0 20px rgba(211,146,6,0.4),0 0 40px rgba(211,190,6,0.3),0 0 60px rgba(211,211,6,0.1);animation:glowPulse 3s ease-in-out infinite}
    @keyframes glowPulse{0%,100%{box-shadow:0 0 20px rgba(211,146,6,0.5),0 0 40px rgba(211,190,6,0.3),0 0 60px rgba(211,211,6,0.1)}50%{box-shadow:0 0 30px rgba(211,146,6,0.6),0 0 60px rgba(211,190,6,0.4),0 0 90px rgba(211,211,6,0.1)}}
    .creator-info{flex:1}
    .creator-title{margin:0;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;font-weight:600}
    .creator-name{margin:4px 0 8px 0;font-size:15px;font-weight:400;color:#e9eef8}
    .github-link{display:inline-flex;align-items:center;gap:6px;color:var(--pastel-blue);text-decoration:none;font-size:14px;font-weight:400;transition:color .2s ease}
    .github-link:hover{color:#c0e3ff}
    .github-link svg{width:18px;height:18px}
    @media(max-width:1200px){body{flex-direction:column;padding:18px}.sidebar{width:100%;position:static}}
    @media(max-width:540px){.container{margin:18px;padding:14px}.line-number{min-width:30px;height:30px;font-size:12px}.copy-btn{padding:6px 10px;font-size:13px}.hex-text{font-size:12px}.creator-box{flex-direction:column;text-align:center}}
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">← Back to Home</a>
    <h1>NotEnoughTinkering</h1>
    <h2>16×16 Texture HEX Converter</h2>
    <div class="upload-box">
      <label for="imageInput" class="upload-label">Import 16x16 Texture</label>
      <input id="imageInput" type="file" accept="image/png, image/jpeg" />
    </div>
    <p id="errorMsg" class="error" role="status" aria-live="polite"></p>
    <div id="preview" aria-hidden="true"></div>
    <h3>HEX Lines</h3>
    <div id="hexContainer" aria-live="polite"></div>
    <p id="generatedLinkBox" class="info-text"></p>
    <div id="yamlSection" class="yaml-block" style="display:none">
      <h3>YAML Generator</h3>
      <div class="yaml-row">
        <label>ID:</label>
        <input id="yamlID" type="text" placeholder="ex: custom_pickaxe" required>
      </div>
      <div class="yaml-row">
        <label>Name:</label>
        <input id="yamlName" type="text" placeholder="ex: Custom Pickaxe" required>
      </div>
      <div class="yaml-row">
        <label>Material:</label>
        <input id="yamlMaterial" type="text" placeholder="ex: DIAMOND" required>
      </div>
      <div class="yaml-row">
        <label>Category:</label>
        <select id="yamlCategory">
          <option value="material">material</option>
          <option value="ferramenta">ferramenta</option>
          <option value="handle">handle</option>
          <option value="pickaxe_head">pickaxe_head</option>
          <option value="axe_head">axe_head</option>
          <option value="sword_head">sword_head</option>
          <option value="shovel_head">shovel_head</option>
          <option value="conector">conector</option>
          <option value="plate">plate</option>
          <option value="upgrade">upgrade</option>
        </select>
      </div>
      <button id="generateYAML" class="copy-btn btn-disabled" style="width:100%;margin-top:10px" disabled>
        Generate & Download YAML
      </button>
    </div>
    <hr class="divider" />
    <h3>How to Use</h3>
    <p class="info-text">Watch this quick tutorial to understand how to import textures and extract HEX lines.</p>
    <div class="video-wrapper" aria-hidden="false">
      <iframe src="https://www.youtube.com/embed/QRfb5IVeU7I?start=2" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
      </iframe>
    </div>
  </div>
  <aside class="sidebar">
    <div class="disclaimer-box">
      <h3 class="disclaimer-title">Disclaimer</h3>
      <p class="disclaimer-text">
        This website is specifically created to be used with the
        <a href="https://polymart.org" target="_blank" rel="noopener noreferrer" class="plugin-link">NotEnoughMatter</a>
        plugin. You can generate the item directly in-game without dealing with files.
      </p>
      <div class="steps-section">
        <h4 class="steps-title">Step-by-Step Guide:</h4>
        <ol class="steps-list">
          <li>Select a 16x16 texture on the website</li>
          <li>Use <code>/nem create &lt;id&gt; &lt;category&gt;</code> and press Enter</li>
          <li>Choose the item name: <code>"&ftest item 123"</code></li>
          <li>Fill the 16x16 grid line by line by copying the corresponding line from the website and sending it in chat to fill the line. Repeat this until you complete the item</li>
          <li>Use <code>/nem give &lt;item id&gt; &lt;player&gt; &lt;amount&gt;</code> to get the item</li>
        </ol>
      </div>
    </div>
    <div class="creator-box">
      <img src="../img/profile.jpg" alt="k0dev profile" class="creator-avatar" onerror="this.style.display='none'">
      <div class="creator-info">
        <p class="creator-title">Coded by</p>
        <p class="creator-name">@k0dev._.0</p>
        <a href="https://github.com/k0dev" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub
        </a>
      </div>
    </div>
  </aside>
  <script>
    const fileInput = document.getElementById("imageInput");
    const errorEl = document.getElementById("errorMsg");
    const previewEl = document.getElementById("preview");
    const container = document.getElementById("hexContainer");
    const linkBox = document.getElementById("generatedLinkBox");
    const yamlSection = document.getElementById("yamlSection");

    let lastCopied = null;
    let currentNext = null;
    let lastPixelList = null;

    function safeCopy(text) {
      if (navigator.clipboard) return navigator.clipboard.writeText(text);
      return Promise.resolve();
    }

    function setNext(target) {
      if (currentNext === target) return;

      if (currentNext) {
        const left = currentNext.querySelector('.left-arrow');
        if (left) left.remove();
        currentNext.classList.remove('next-glow', 'slide-down');
      }

      currentNext = target;
      if (!target) return;

      target.classList.add('next-glow');

      if (!target.querySelector('.left-arrow')) {
        const arr = document.createElement('div');
        arr.className = 'left-arrow big-arrow';
        arr.textContent = '›';
        target.appendChild(arr);
      }

      target.classList.remove('slide-down');
      void target.offsetWidth;
      target.classList.add('slide-down');
    }

    function createLineBox(line, idx) {
      const box = document.createElement('div');
      box.className = 'hex-line-box';

      const num = document.createElement('div');
      num.className = 'line-number';
      num.textContent = (idx+1) + '.';

      const txt = document.createElement('div');
      txt.className = 'hex-text';
      txt.textContent = line;

      const btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.textContent = 'Copy';

      const label = document.createElement('div');
      label.className = 'copied-label';
      label.textContent = 'Copied!';

      btn.addEventListener('click', async () => {
        await safeCopy(line);

        if (lastCopied) {
          lastCopied.box.classList.remove('copied');
          lastCopied.label.classList.remove('visible');
        }

        box.classList.add('copied');
        label.classList.add('visible');
        lastCopied = { box, label };

        const next = box.nextElementSibling;
        if (next) setNext(next);
        else setNext(null);
      });

      box.appendChild(num);
      box.appendChild(txt);
      box.appendChild(btn);
      box.appendChild(label);
      return box;
    }

    function rgbToDecimal(hex) {
      if (hex === "0") return 0;
      const r = parseInt(hex.slice(1,3), 16);
      const g = parseInt(hex.slice(3,5), 16);
      const b = parseInt(hex.slice(5,7), 16);
      return (r * 65536) + (g * 256) + b;
    }

    function checkYamlFields() {
      const id = document.getElementById("yamlID").value.trim();
      const name = document.getElementById("yamlName").value.trim();
      const mat = document.getElementById("yamlMaterial").value.trim();
      const btn = document.getElementById("generateYAML");
      
      if (id && name && mat && lastPixelList) {
        btn.disabled = false;
        btn.classList.remove('btn-disabled');
      } else {
        btn.disabled = true;
        btn.classList.add('btn-disabled');
      }
    }

    document.getElementById("yamlID").addEventListener('input', checkYamlFields);
    document.getElementById("yamlName").addEventListener('input', checkYamlFields);
    document.getElementById("yamlMaterial").addEventListener('input', checkYamlFields);

    fileInput.addEventListener('change', function(e) {
      const file = this.files[0];

      errorEl.textContent = '';
      previewEl.innerHTML = '';
      container.innerHTML = '';
      linkBox.textContent = '';
      lastCopied = null;
      currentNext = null;
      lastPixelList = null;
      yamlSection.style.display = 'none';

      if (!file) return;

      const img = new Image();
      const url = URL.createObjectURL(file);
      img.src = url;

      img.onload = async () => {
        const w = img.width;
        const h = img.height;

        if (w !== 16 || h !== 16) {
          errorEl.textContent = `Error: Only 16x16 textures supported. ${w}x${h} detected.`;
          URL.revokeObjectURL(url);
          return;
        }

        previewEl.innerHTML = `<img src="${url}" alt="Imported 16x16 preview">`;

        const canvas = document.createElement('canvas');
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, w, h).data;

        const lines = [];
        const fullList = [];

        for (let y = 0; y < h; y++) {
          const row = [];
          for (let x = 0; x < w; x++) {
            const i = (y * w + x) * 4;
            const r = data[i];
            const g = data[i+1];
            const b = data[i+2];
            const a = data[i+3];

            if (a === 0) {
              row.push('0');
              fullList.push('0');
            } else {
              const hex = "#" +
                r.toString(16).padStart(2, '0') +
                g.toString(16).padStart(2, '0') +
                b.toString(16).padStart(2, '0');

              row.push(hex);
              fullList.push(hex);
            }
          }
          lines.push(row.join(", "));
        }

        lines.forEach((line, idx) => {
          container.appendChild(createLineBox(line, idx));
        });

        const first = container.querySelector('.hex-line-box');
        if (first) setNext(first);

        lastPixelList = fullList.map(rgbToDecimal);
        
        yamlSection.style.display = 'block';
        checkYamlFields();

        URL.revokeObjectURL(url);
      };

      img.onerror = () => {
        errorEl.textContent = "Error: could not load the image.";
        URL.revokeObjectURL(url);
      };
    });

    document.getElementById("generateYAML").addEventListener("click", () => {
      if (!lastPixelList) {
        alert("Import a texture first.");
        return;
      }

      const id = document.getElementById("yamlID").value.trim();
      const name = document.getElementById("yamlName").value.trim();
      const mat = document.getElementById("yamlMaterial").value.trim();
      const cat = document.getElementById("yamlCategory").value;

      if (!id || !name || !mat) {
        alert("Please fill in all fields (ID, Name, and Material).");
        return;
      }

      let yaml = "";
      yaml += `id: ${id}\n`;
      yaml += `name: ${name}\n`;
      yaml += `category: ${cat}\n`;
      yaml += `material: ${mat}\n`;
      yaml += `pixels:\n`;

      lastPixelList.forEach((v, i) => {
        if (v !== 0) {
          yaml += `  '${i}': ${v}\n`;
        }
      });

      const blob = new Blob([yaml], { type: "text/yaml" });
      const url = URL.createObjectURL(blob);

      const dl = document.createElement('a');
      dl.href = url;
      dl.download = `${id}.yml`;
      dl.click();
      
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>